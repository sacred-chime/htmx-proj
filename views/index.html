{{ block "index" . }}
<!DOCTYPE html>
<html lang="en">

  <head>
    <title>HTMX</title>
    <meta charset="UTF-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1" />
    <script src="https://unpkg.com/htmx.org/dist/htmx.min.js"></script>
  </head>

  <body>
    {{ template "form" .Form }}
    <hr />
    {{ template "display" .Data }}

    <script type="text/javascript">
      document.addEventListener("DOMContentLoaded", (event) => {
        document.body.addEventListener('htmx:beforeSwap', function (evt) {
          if (evt.detail.xhr.status === 422) {
            console.log("setting status to paint");
            // allow 422 responses to swap as we are using this as a signal that
            // a form was submitted with bad data and want to rerender with the
            // errors
            //
            // set isError to false to avoid error logging in console
            evt.detail.shouldSwap = true;
            evt.detail.isError = false;
          }
        });
      });
    </script>
  </body>

</html>
{{ end }}

{{ block "form" .}}
<form hx-swap="outerHTML"
      hx-post="/contacts">
  <label for="name">Name</label>
  <input {{ if .Values.name }}value="{{ .Values.name }}"
         {{ end }}
         name="name"
         placeholder="Name" />

  <label for="email">Email</label>
  <input {{ if .Values.email }}value="{{ .Values.email }}"
         {{ end }}
         name="email"
         placeholder="Email" />

  {{ if .Errors.email}}
  <div style="color: red">{{ .Errors.email }}</div>
  {{ end }}

  <button type="submit">Submit</button>
</form>
{{ end }}

{{ block "display". }}
<div id="contacts"
     style="display: flex; flex-direction: column">
  {{ range .Contacts }}
  {{ template "contact" . }}
  {{ end }}
</div>
{{ end }}

{{ block "contact" .}}
<div>
  Name:
  <span>{{ .Name }}</span>
  Email:
  <span>{{ .Email }}</span>
</div>
{{ end }}

{{ block "oob-contact" .}}
<div id="contacts"
     hx-swap-oob="afterbegin">
  {{ template "contact" . }}
</div>
{{ end }}